import{b as z,t as L}from"../chunks/disclose-version.BkVNUjsP.js";import{A as te,G as re,D as w,o as B,p as ne,i as ie,y as J,W as se,X as V,l as H,q as N,Y as R,Z as Q,B as W,_ as oe,e as Y,$ as le,a0 as fe,x as ue,a1 as ce,J as de,h as ve,r as _e,c as pe,m as he,a2 as $,a3 as ge,a4 as ye,a5 as me,j as be,a6 as O,a7 as xe,C as Z,a8 as I,E as K,s as A,T as F,U as q,S as Ae,g as t,M as Ee,V as U,Q as we}from"../chunks/runtime.C8Ha8fQX.js";import{d as P,s as Se}from"../chunks/render.DOveubZj.js";import{p as k,o as j,b as Ce}from"../chunks/index-client.DOYLFJBP.js";function Te(r,e,a,n){for(var f=[],s=e.length,o=0;o<s;o++)fe(e[o].e,f,!0);var u=s>0&&f.length===0&&a!==null;if(u){var _=a.parentNode;ue(_),_.append(a),n.clear(),S(r,e[0].prev,e[s-1].next)}ce(f,()=>{for(var p=0;p<s;p++){var i=e[p];u||(n.delete(i.k),S(r,i.prev,i.next)),de(i.e,!u)}})}function Ie(r,e,a,n,f,s=null){var o=r,u={flags:e,items:new Map,first:null};{var _=r;o=w?B(ve(_)):_.appendChild(te())}w&&ne();var p=null,i=!1;re(()=>{var h=a(),c=ie(h)?h:h==null?[]:J(h),l=c.length;if(i&&l===0)return;i=l===0;let y=!1;if(w){var b=o.data===se;b!==(l===0)&&(o=V(),B(o),H(!1),y=!0)}if(w){for(var m=null,d,g=0;g<l;g++){if(N.nodeType===8&&N.data===_e){o=N,y=!0,H(!1);break}var C=c[g],x=n(C,g);d=ee(N,u,m,null,C,x,g,f,e),u.items.set(x,d),m=d}l>0&&B(V())}if(!w){var v=pe;Me(c,u,o,f,e,(v.f&R)!==0,n)}s!==null&&(l===0?p?Q(p):p=W(()=>s(o)):p!==null&&oe(p,()=>{p=null})),y&&H(!0),a()}),w&&(o=N)}function Me(r,e,a,n,f,s,o){var u=r.length,_=e.items,p=e.first,i=p,h,c=null,l=[],y=[],b,m,d,g;for(g=0;g<u;g+=1){if(b=r[g],m=o(b,g),d=_.get(m),d===void 0){var C=i?i.e.nodes_start:a;c=ee(C,e,c,c===null?e.first:c.next,b,m,g,n,f),_.set(m,c),l=[],y=[],i=c.next;continue}if(ke(d,b,g),d.e.f&R&&Q(d.e),d!==i){if(h!==void 0&&h.has(d)){if(l.length<y.length){var x=y[0],v;c=x.prev;var T=l[0],M=l[l.length-1];for(v=0;v<l.length;v+=1)X(l[v],x,a);for(v=0;v<y.length;v+=1)h.delete(y[v]);S(e,T.prev,M.next),S(e,c,T),S(e,M,x),i=x,c=M,g-=1,l=[],y=[]}else h.delete(d),X(d,i,a),S(e,d.prev,d.next),S(e,d,c===null?e.first:c.next),S(e,c,d),c=d;continue}for(l=[],y=[];i!==null&&i.k!==m;)(s||!(i.e.f&R))&&(h??(h=new Set)).add(i),y.push(i),i=i.next;if(i===null)continue;d=i}l.push(d),c=d,i=d.next}if(i!==null||h!==void 0){for(var E=h===void 0?[]:J(h);i!==null;)(s||!(i.e.f&R))&&E.push(i),i=i.next;var D=E.length;if(D>0){var ae=u===0?a:null;Te(e,E,ae,_)}}Y.first=e.first&&e.first.e,Y.last=c&&c.e}function ke(r,e,a,n){le(r.v,e),r.i=a}function ee(r,e,a,n,f,s,o,u,_){var p=(_&ye)!==0,i=(_&me)===0,h=p?i?he(f):$(f):f,c=_&ge?$(o):o,l={i:c,v:h,k:s,a:null,e:null,prev:a,next:n};try{return l.e=W(()=>u(r,h,c),w),l.e.prev=a&&a.e,l.e.next=n&&n.e,a===null?e.first=l:(a.next=l,a.e.next=l.e),n!==null&&(n.prev=l,n.e.prev=l.e),l}finally{}}function X(r,e,a){for(var n=r.next?r.next.e.nodes_start:a,f=e?e.e.nodes_start:a,s=r.e.nodes_start;s!==n;){var o=be(s);f.before(s),s=o}}function S(r,e,a){e===null?r.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}function De(r,e,a,n){var f=r.__attributes??(r.__attributes={});w&&(f[e]=r.getAttribute(e)),f[e]!==(f[e]=a)&&(Ne(r).includes(e)?r[e]=a:r.setAttribute(e,a))}var G=new Map;function Ne(r){var e=G.get(r.nodeName);if(e)return e;G.set(r.nodeName,e=[]);for(var a,n=O(r),f=Element.prototype;f!==n;){a=xe(n);for(var s in a)a[s].set&&e.push(s);n=O(n)}return e}var Re=(r,e)=>e.onselect(r.target.value),qe=L("<option> </option>"),Be=L('<select class="rounded border px-4 py-2 pr-8"></select>');function He(r,e){Z(e,!0);async function a(){return(await navigator.mediaDevices.enumerateDevices()).filter(u=>u.kind==="audioinput").map(u=>({id:u.deviceId,label:u.label}))}let n=I(k([]));j(()=>{a().then(s=>{A(n,k(s))})});var f=Be();f.__input=[Re,e],Ie(f,21,()=>t(n),s=>s.id,(s,o)=>{var u=qe(),_={},p=F(u,!0);q(u),Ae(()=>{_!==(_=t(o).id)&&(u.value=(u.__value=t(o).id)==null?"":t(o).id),Se(p,t(o).label)}),z(s,u)}),q(f),z(r,f),K()}P(["input"]);var Ue=(r,e)=>void e(),ze=(r,e)=>e(),Fe=L('<div><canvas width="800"></canvas> <div><button class="rounded border px-4 py-2">Start</button> <button class="rounded border px-4 py-2">Stop</button> <!></div></div>');function Oe(r,e){Z(e,!0);let a=I(void 0),n=I(void 0);const f=2048;j(()=>{A(a,k(new AudioContext)),A(n,k(t(a).createAnalyser())),t(n).fftSize=f});let s=I(!1),o=I(void 0),u=we(()=>{var v;return(v=t(o))==null?void 0:v.getContext("2d")}),_=I(void 0),p=I(void 0);async function i(){if(!t(a)||!t(n))return;const v=await navigator.mediaDevices.getUserMedia({audio:t(p)?{deviceId:{exact:t(p)}}:!0,video:!1});A(_,k(t(a).createMediaStreamSource(v))),t(_).connect(t(n)),t(a).resume(),A(s,!0)}function h(){var v;!t(a)||!t(n)||(t(_)&&(t(_).disconnect(),t(_).mediaStream.getTracks().forEach(T=>T.stop()),A(_,void 0),(v=t(a))==null||v.suspend()),A(s,!1))}let c=0;function l(v){if(!t(a)||!t(n)||!t(s)||!t(u)||!t(o)||(requestAnimationFrame(l),t(o).height!=t(n).frequencyBinCount&&(t(o).height=t(n).frequencyBinCount),v-c<10))return;c=v;const T=t(n).frequencyBinCount,M=new Uint8Array(T);t(n).getByteFrequencyData(M),t(u).drawImage(t(o),1,0);for(let E=0;E<T;(E+=1)-1){const D=M[E];t(u).fillStyle=`rgb(${D} ${D} ${D})`,t(u).fillRect(0,E,1,1)}}Ee(()=>{t(s)&&requestAnimationFrame(l)});function y(v){A(p,k(v)),t(s)&&(h(),i())}var b=Fe(),m=F(b);De(m,"height",f/2),Ce(m,v=>A(o,v),()=>t(o));var d=U(m,2),g=F(d);g.__click=[Ue,i];var C=U(g,2);C.__click=[ze,h];var x=U(C,2);He(x,{onselect:y}),q(d),q(b),z(r,b),K()}P(["click"]);export{Oe as component};
